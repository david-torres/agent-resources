{{> breadcrumbs}}
<h2 class="title is-3">{{#if isNew}}Create New Class{{else}}Edit Class{{/if}}</h2>
<form hx-{{#if isNew}}post{{else}}put{{/if}}="/classes{{#unless isNew}}/{{class.id}}{{/unless}}" hx-redirect="{{#if isNew}}/classes{{else}}/classes/{{class.id}}/{{encodeURIComponentH class.name}}{{/if}}" hx-encoding="multipart/form-data" enctype="multipart/form-data">
  <div class="field is-grouped">
    <label class="label">Rules Edition</label>
    <div class="control">
      <select class="select" name="rules_edition">
        <option value="advent" {{#if (eq class.rules_edition "advent")}}selected{{/if}}>Advent</option>
        <option value="aspirant" {{#if (eq class.rules_edition "aspirant")}}selected{{/if}} disabled>Aspirant</option>
      </select>
    </div>
    <label class="label">Rules Version</label>
    <div class="control">
      <select class="select" name="rules_version">
        <option value="v1" {{#if (eq class.rules_version "v1")}}selected{{/if}}>v1</option>
        <option value="v2" {{#if (eq class.rules_version "v2")}}selected{{/if}}>v2</option>
      </select>
    </div>
    <label class="label">Status</label>
    <div class="control">
      <select class="select" name="status">
        {{#if (eq profile.role 'admin')}}
        <option value="release" {{#if (eq class.status "release")}}selected{{/if}}>Release</option>
        {{/if}}
        <option value="beta" {{#if (eq class.status "beta")}}selected{{/if}}>Beta</option>
        <option value="alpha" {{#if (eq class.status "alpha")}}selected{{/if}}>Alpha</option>
      </select>
    </div>
  </div>
  <div class="field">
    {{#if (eq profile.role 'admin')}}
      <label class="label">Type</label>
      <div class="control">
        <label class="radio">
          <input type="radio" name="is_player_created" value="false" {{#unless isNew}}{{#unless class.is_player_created}}checked{{/unless}}{{/unless}}>
          Official
        </label>
        <label class="radio">
          <input type="radio" name="is_player_created" value="true" {{#if isNew}}checked{{else}}{{#if class.is_player_created}}checked{{/if}}{{/if}}>
          PCC (player-created)
        </label>
      </div>
      
    {{else}}
      <input type="hidden" name="is_player_created" value="true">
    {{/if}}
  </div>
  <div class="field">
    <label class="label">Name</label>
    <div class="control">
      <input class="input" type="text" name="name" placeholder="Class Name" value="{{class.name}}" required>
    </div>
  </div>
  <div class="field">
    <label class="label">Teaser</label>
    <div class="control">
      <textarea class="textarea" name="teaser" placeholder="Short description for class list display (optional)">{{class.teaser}}</textarea>
    </div>
  </div>
  <div class="field">
    <label class="checkbox">
      <input type="checkbox" name="is_public" {{#if class.is_public}}checked{{/if}}>
      Public (visible to everyone)
    </label>
  </div>
  <div class="field">
    <label class="label">Description</label>
    <div class="control">
      <textarea class="textarea" name="description" placeholder="Class Description"
        required>{{class.description}}</textarea>
    </div>
  </div>
  <div class="field">
    <label class="label">Image</label>
    <div class="control">
      <input class="input" type="text" name="image_url" value="{{class.image_url}}">
    </div>
    <p class="help">Use a link to your image. We'll render it using the crop below without uploading.</p>
  </div>
  <div class="field">
    <label class="label">Image Crop &amp; Preview</label>
    <div class="profile-image-editor" data-image-cropper data-image-input="input[name='image_url']" data-crop-input="input[name='image_crop']">
      <div class="profile-image-editor__canvas">
        <img data-cropper-image src="{{class.image_url}}" alt="Class image cropper">
        <div class="profile-image-editor__placeholder" data-crop-placeholder {{#if class.image_url}}hidden{{/if}}>Add an image URL to start cropping</div>
      </div>
      <div class="profile-image-editor__preview" data-crop-preview aria-label="Class image preview"></div>
    </div>
    <input type="hidden" name="image_crop" value='{{{json class.image_crop}}}'>
    <p class="help">Adjust the crop to control how this class art appears across the app.</p>
  </div>
  <div class="field">
    <label class="label">Class PDF (optional)</label>
    <div class="control">
      <input class="input" type="file" name="class_pdf" accept="application/pdf">
    </div>
    <p class="help">Upload a PDF to share full class rules. Max size 25MB.</p>
    {{#if class.pdf_storage_path}}
    <div class="mt-2">
      <p class="help">
        {{#if class.pdf_updated_at}}Last updated {{date_tz class.pdf_updated_at}}{{/if}}
        Â· <a href="/classes/{{class.id}}/pdf" target="_blank" rel="noopener">Preview current PDF</a>
      </p>
      <label class="checkbox">
        <input type="checkbox" name="remove_pdf">
        Remove existing PDF
      </label>
    </div>
    {{/if}}
  </div>
    <!-- classes have 3 abilities (name and description) -->
    {{#if (or isNew (eq class.abilities.length 0))}}
      {{#times 3}}
        <div class="field">
          <label class="label">Ability {{add @index 1}}</label>
          <div class="control">
            <input class="input" type="text" name="ability_name[]" placeholder="Ability {{add @index 1}}" required>
          </div>
          <label class="label">Ability {{add @index 1}} Description</label>
          <div class="control">
            <textarea class="textarea" name="ability_description[]" placeholder="Ability {{add @index 1}} Description"></textarea>
          </div>
        </div>
      {{/times}}
    {{else}}
      {{#each class.abilities}}
        <div class="field">
          <label class="label">Ability {{add @index 1}}</label>
          <div class="control">
            <input class="input" type="text" name="ability_name[]" placeholder="Ability {{add @index 1}}" value="{{this.name}}" required>
          </div>
          <label class="label">Ability {{add @index 1}} Description</label>
          <div class="control">
            <textarea class="textarea" name="ability_description[]" placeholder="Ability {{add @index 1}} Description">{{this.description}}</textarea>
          </div>
        </div>
      {{/each}}
    {{/if}}
    <!-- classes have 6 gear items (name and description) -->
    {{#if (or isNew (eq class.gear.length 0))}}
      {{#times 6}}
        <div class="field">
          <label class="label">
            {{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}}
          </label>
          <div class="control">
            <input class="input" type="text" name="gear_name[]" placeholder="{{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}}" required>
          </div>
          <label class="label">
            {{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}} Description
          </label>
          <div class="control">
            <textarea class="textarea" name="gear_description[]" placeholder="{{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}} Description"></textarea>
          </div>
        </div>
      {{/times}}
    {{else}}
      {{#each class.gear}}
        <div class="field">
          <label class="label">
            {{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}}
          </label>
          <div class="control">
            <input class="input" type="text" name="gear_name[]" placeholder="{{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}}" value="{{this.name}}" required>
          </div>
          <label class="label">
            {{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}} Description
          </label>
          <div class="control">
            <textarea class="textarea" name="gear_description[]" placeholder="{{#if (lt @index 3)}}Base{{else}}Elective{{/if}} Gear {{#if (lt @index 3)}}{{add @index 1}}{{else}}{{subtract @index 2}}{{/if}} Description">{{this.description}}</textarea>
          </div>
        </div>
      {{/each}}
    {{/if}}
  <div class="field">
    <div class="control">
      <button class="button is-primary" type="submit">Save</button>
    </div>
  </div>
  </form>
