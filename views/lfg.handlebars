<h2 class="title is-2">Looking for Game</h2>
<div class="block">
  <div class="content">
    <p>Find other agents to join you in your Enclave missions. Create a post to find players or join a post to hop into
      a game.</p>
  </div>
  <div class="block" id="create-post">
    <button class="button is-primary" hx-get="/lfg/new" hx-swap="outerHTML">Create LFG Post</button>
  </div>
</div>
<hr/>

{{#if ownPosts.length}}
<div id="lfg-posts" class="block">
  <h3 class="title is-3">Your LFG Posts</h3>
  <table class="table is-fullwidth">
    <thead>
      <tr>
        <th>Title</th>
        <th>Date</th>
        <th>Conduit</th>
        <th>Status</th>
        <th class="is-pulled-right">Actions</th>
      </tr>
    </thead>
    <tbody>
      {{#each ownPosts}}
      <tr>
        <td>{{this.title}}</td>
        <td>{{date this.date "dddd, MMMM Do YYYY, h:mm"}}</td>
        <td>
          {{#if this.host_id}}
          {{this.host_name}}
          {{else}}
          <span class="tag is-warning">Conduit needed</span>
          {{/if}}
        </td>
        <td>
          {{this.status}}
        </td>
        <td>
          <div class="buttons is-right">
            <button class="button is-danger is-small" hx-delete="/lfg/{{this.id}}" hx-confirm="Are you sure?" hx-swap="outerHTML">Delete</button>
            <button class="button is-warning is-small" hx-get="/lfg/{{this.id}}/edit" hx-swap="outerHTML" hx-target="closest table">Edit</button>
            <a class="button is-secondary is-small" href="/lfg/{{this.id}}">View</a>
            <button class="button is-primary is-small" hx-get="/lfg/{{this.id}}/requests" hx-swap="outerHTML" hx-target="closest table">View Join Requests</button>
          </div>
        </td>
      </tr>
      {{/each}}
    </tbody>
  </table>
</div>
{{else}}
<p class="has-text-centered">You have not created any LFG posts.</p>
{{/if}}
<hr/>

{{#if posts.length}}
<div id="lfg-posts" class="block">
  <h3 class="title is-3">Public LFG Posts</h3>
  {{#each posts}}
  <div class="box lfg-post">
    <h3 class="title is-4">{{this.title}}</h3>
    <p>Date: {{date this.date "dddd, MMMM Do YYYY, h:mm"}}</p>
    <p class="is-size-7">Created by: {{this.creator_name}}</p>
    <p class="mt-4">
      {{#if this.host_id}}
      Conduit: {{this.host_name}}{{else}}<span class="tag is-warning">Conduit needed</span>
      {{/if}}
    </p>
    <div class="box content mt-4">
      {{{markdown this.description}}}
    </div>
    <div class="buttons is-right">
      {{#if (eq this.host_id profile.id)}}
      <button class="button is-danger" hx-delete="/lfg/{{this.id}}/join" hx-confirm="Are you sure?" hx-swap="outerHTML">Unjoin as Conduit</button>
      {{else}}
      {{#inArray (pluck this.join_requests "profile_id") (lookup ../profile "id")}}
      <button class="button is-danger" hx-delete="/lfg/{{this.id}}/join" hx-confirm="Are you sure?" hx-swap="outerHTML">Unjoin as Player</button>
      {{else}}
      <button class="button is-primary" hx-get="/lfg/{{this.id}}/join" hx-swap="outerHTML">Join</button>
      {{/inArray}}
      {{/if}}
    </div>
  </div>
  {{/each}}
</div>
{{else}}
<p class="has-text-centered">No LFG posts yet.</p>
{{/if}}